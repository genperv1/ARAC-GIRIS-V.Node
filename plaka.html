<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <title>Plaka AyÄ±rma Sistemi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50 min-h-screen text-gray-700">
  <header class="bg-gradient-to-r from-slate-800 to-indigo-700 text-white">
    <div class="max-w-7xl mx-auto px-4 py-5 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 bg-white/10 rounded flex items-center justify-center font-bold">AT</div>
        <div>
          <div class="text-lg font-semibold">Plaka AyÄ±rma</div>
          <div class="text-xs opacity-80">Toplu plaka iÅŸlemleri</div>
        </div>
      </div>
      <div class="text-sm opacity-80">HÄ±zlÄ± ve gÃ¼venilir</div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-6">
    <section class="bg-white shadow rounded-xl p-6 mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <h1 class="text-xl font-bold">ðŸ“‹ Plaka AyÄ±rma Sistemi</h1>
        <div class="flex gap-3">
          <div class="bg-slate-50 px-4 py-2 rounded-lg">
            <div class="text-xs text-slate-500">Toplam BBT</div>
            <div class="font-bold text-lg" id="totalBBT">0</div>
          </div>
          <div class="bg-slate-50 px-4 py-2 rounded-lg">
            <div class="text-xs text-slate-500">Plaka SayÄ±sÄ±</div>
            <div class="font-bold text-lg" id="count">0</div>
          </div>
        </div>
      </div>
    </section>

    <section class="grid lg:grid-cols-2 gap-6">
      <div class="bg-white rounded-xl shadow p-4">
        <div class="flex gap-2 mb-3">
          <button onclick="parse()" class="px-4 py-2 bg-indigo-600 text-white rounded">AYIR</button>
          <button onclick="clearAll()" class="px-4 py-2 bg-red-600 text-white rounded">TEMÄ°ZLE</button>
        </div>
        <textarea id="input" class="w-full min-h-[260px] p-3 border rounded" placeholder="PlakalarÄ± buraya yapÄ±ÅŸtÄ±r..."></textarea>
      </div>

      <div class="bg-white rounded-xl shadow p-4">
        <div class="flex gap-2 justify-center mb-3">
          <button class="px-3 py-1 bg-slate-200 rounded text-sm" onclick="copyCol(0)">SIRA NO KOPYALA</button>
          <button class="px-3 py-1 bg-slate-200 rounded text-sm" onclick="copyCol(1)">PLAKA KOPYALA</button>
          <button class="px-3 py-1 bg-slate-200 rounded text-sm" onclick="copyCol(2)">BBT KOPYALA</button>
        </div>

        <div class="overflow-auto">
          <table class="min-w-full table-auto">
            <thead class="text-xs text-slate-500 uppercase">
              <tr>
                <th class="p-2 text-center">SÄ±ra</th>
                <th class="p-2 text-left">Plaka</th>
                <th class="p-2 text-right">BBT</th>
              </tr>
            </thead>
            <tbody id="tbody" class="text-sm"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <script>
  let rows = [];

  function normalizePlate(s){
    s = String(s||'').toUpperCase().replace(/[^A-Z0-9]/g,' ');
    const m = s.match(/(\d{2})\s*([A-Z]{1,3})\s*(\d{2,5})/);
    return m ? m[1]+m[2]+m[3] : null;
  }

  function parse(){
    const lines = (document.getElementById('input').value||'').split(/\n+/);
    rows = [];
    let total = 0;
    lines.forEach(l => {
      if(/iptal/i.test(l)) return;
      const plate = normalizePlate(l);
      const bbtMatch = l.match(/(\d+)\s*BBT|\/(\d+)/i);
      const bbt = bbtMatch ? parseInt(bbtMatch[1]||bbtMatch[2]) : null;
      if(plate && bbt){ rows.push({ plate, bbt }); total += bbt; }
    });
    render(total);
  }

  function render(total){
    const tb = document.getElementById('tbody'); tb.innerHTML = '';
    rows.forEach((r,i) => {
      tb.insertAdjacentHTML('beforeend', `<tr class="border-b"><td class="p-2 text-center">${i+1}</td><td class="p-2">${r.plate}</td><td class="p-2 text-right">${r.bbt}</td></tr>`);
    });
    document.getElementById('totalBBT').textContent = total;
    document.getElementById('count').textContent = rows.length;
  }

  function clearAll(){
    document.getElementById('input').value = '';
    document.getElementById('tbody').innerHTML = '';
    document.getElementById('totalBBT').textContent = '0';
    document.getElementById('count').textContent = '0';
    rows = [];
  }

  function copyCol(idx){
    let txt = '';
    if(idx === 0) txt = rows.map((_, i) => String(i+1)).join('\r\n');
    if(idx === 1) txt = rows.map(r => String(r.plate)).join('\r\n');
    if(idx === 2) txt = rows.map(r => String(r.bbt)).join('\r\n');
    navigator.clipboard.writeText(txt).then(()=> alert('KopyalandÄ±')).catch(err => { alert('Kopyalama hatasÄ±'); console.error(err); });
  }
  </script>
</body>
</html>
